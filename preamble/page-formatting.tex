%% The LaTeX project Prassble
%% page-formatting.tex: page formatting (page head, chapter, section, etc styles)
%%
%% -------------------------------------------------------------------------------------------
%% Copyright (c) 2025 by Grass (GrassGlass) <shaohong00002 at gmail dot com>
%% -------------------------------------------------------------------------------------------
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `author-maintained'.
%%
%% This work consists of all files listed in README
%%
% pagestyles

  % default pagestyle
  \ifundef{\Pagestyle}{\gdef\Pagestyle{main}}{}

  % \HeaderColour
  \ifdefstring{\ColourTheme}{colourful}{\gdef\HeaderColour{HeaderColour}}{}
  \ifdefstring{\ColourTheme}{BnW}{\gdef\HeaderColour{black}}{}

  % change the color of \headrule to HeaderColour
  \makeatletter
    \renewcommand{\setheadrule}[1]{\ifdim #1=\z@ \let \makeheadrule \@empty \else \def \makeheadrule{\color{\HeaderColour}\rule[-.3\baselineskip]{\linewidth }{#1}}\fi}
  \makeatother

  % main pagestyle
    % source1: https://tex.stackexchange.com/a/311505/383565
    % source2: https://sg.mirrors.cicku.me/ctan/macros/latex/contrib/titlesec/titlesec.pdf
  \newpagestyle{main}[\sffamily\color{\HeaderColour}]
  {
    \sethead[\thepage][\chaptertitle][\thesection] % even
    {\thesection}{\sectiontitle}{\thepage}         % odd
    \headrule
  } 

  % hw pagestyle
  \makeatletter
    \newpagestyle{hw}[\sffamily\color{\HeaderColour}]
    {
    \sethead{\@author}{\CourseName\ Homework \#\theHWNumber}{\thepage}
    \headrule
    }
  \makeatother
    % external referencing setup which allows the contents of main.tex to be referenced in hw documents
    \ExplSyntaxOn
      \tl_if_eq:NnT \Pagestyle {hw} {
        \zexternaldocument{\g_Prassble_path_to_Prassble_folder_tl/main}
      }
    \ExplSyntaxOff

% Select the pagestyle based on \Pagestyle
\pagestyle{\Pagestyle}

% page foot: remove page number from the bottom of chapter pages
  \assignpagestyle{\chapter}{empty}

% chapter
  % Source: https://tex.stackexchange.com/a/169435
  \titleformat{\chapter}[display]
    {\normalfont\bfseries\color{\HeaderColour}}
    {\filleft\hspace*{-60pt}%
      \rotatebox[origin=c]{90}{%
        \normalfont\color{black}\Large%
          \textls[180]{\textsc{\chaptertitlename}}%
      }\hspace{10pt}%
      {\setlength\fboxsep{0pt}%
      \colorbox{\HeaderColour}{\parbox[c][3cm][c]{2.5cm}{%
        \centering\color{white}\fontsize{80}{90}\selectfont\thechapter}%
      }}%
    }
    {10pt}
    {\titlerule[2.5pt]\vskip3pt\titlerule\vskip4pt\LARGE\sffamily}

% section
  % Source: https://tex.stackexchange.com/a/738974/383565
  \titleformat{\section}[hang]
    {\normalfont\Large\bfseries\color{\HeaderColour}}
    {%
    \begingroup
    \setlength\fboxsep{3.5pt}%
    \colorbox{\HeaderColour}{\color{white}\thesection}%
    \endgroup
    }
    {5pt}
    {}

% subsection
  \titleformat{\subsection}[hang]
    {\normalfont\Large\bfseries\color{\HeaderColour}}
    {%
    \begingroup
    \setlength\fboxsep{3pt}%
    \setlength\fboxrule{0.9pt}%
    \fbox{\thesubsection}%
    \endgroup
    }
    {5pt}
    {}