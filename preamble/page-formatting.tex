%% The LaTeX project Prassble
%% page-formatting.tex: page formatting (page head, chapter, section, etc styles)
%%
%% -------------------------------------------------------------------------------------------
%% Copyright (c) 2025 by Grass (GrassGlass) <shaohong00002 at gmail dot com>
%% -------------------------------------------------------------------------------------------
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `author-maintained'.
%%
%% This work consists of all files listed in README
%%
\ExplSyntaxOn
% \Pagestyle command to select a pagestyle and store it's name
\tl_new:N \SelectedPagestyle
\NewDocumentCommand{\Pagestyle}{ m }
{
  \tl_gset:Nn \SelectedPagestyle {#1}
  \pagestyle{#1}
}
  % \ColorTheme command to select a colour theme and store it's name
  \tl_new:N \SelectedColourTheme
  \NewDocumentCommand{\ColorTheme}{ m }{
    \tl_gset:Nn \SelectedColourTheme {#1}
  }
\ExplSyntaxOff

  % default colour theme
  \ColorTheme{colourful}


% pagestyles
  % main pagestyle
    % source1: https://tex.stackexchange.com/a/311505/383565
    % source2: https://sg.mirrors.cicku.me/ctan/macros/latex/contrib/titlesec/titlesec.pdf
  \newpagestyle{main}[\sffamily\color{HeaderColor}]
  {
    \sethead[\thepage][\chaptertitle][\thesection] % even
    {\thesection}{\sectiontitle}{\thepage}         % odd
  } 

  % hw pagestyle
  \makeatletter
    \newpagestyle{hw}[\sffamily\color{HeaderColor}]
    {
    \sethead{\@author}{\CourseName\ Homework \#\theHWNumber}{\thepage}
    \color{HeaderColor}\headrule
    }
  \makeatother
    % external referencing setup which allows the contents of main.tex to be referenced in hw documents
    \ExplSyntaxOn
      \AtEndPreamble{
        \tl_if_eq:NnT \SelectedPagestyle {hw} {
          \zexternaldocument{\g_Prassble_path_to_Prassble_folder_tl/main}
        }
      }
    \ExplSyntaxOff

  % default pagestyle
  \Pagestyle{main}

% page foot: remove page number from the bottom of chapter pages
  \assignpagestyle{\chapter}{empty}

% chapter
  % Source: https://tex.stackexchange.com/a/169435
  \titleformat{\chapter}[display]
    {\normalfont\bfseries\color{HeaderColor}}
    {\filleft\hspace*{-60pt}%
      \rotatebox[origin=c]{90}{%
        \normalfont\color{black}\Large%
          \textls[180]{\textsc{\chaptertitlename}}%
      }\hspace{10pt}%
      {\setlength\fboxsep{0pt}%
      \colorbox{HeaderColor}{\parbox[c][3cm][c]{2.5cm}{%
        \centering\color{white}\fontsize{80}{90}\selectfont\thechapter}%
      }}%
    }
    {10pt}
    {\titlerule[2.5pt]\vskip3pt\titlerule\vskip4pt\LARGE\sffamily}

% section
  % Source: https://tex.stackexchange.com/a/738974/383565
  \titleformat{\section}[hang]
    {\normalfont\Large\bfseries\color{HeaderColor}}
    {%
    \begingroup
    \setlength\fboxsep{3.5pt}%
    \colorbox{HeaderColor}{\color{white}\thesection}%
    \endgroup
    }
    {5pt}
    {}

% subsection
  \titleformat{\subsection}[hang]
    {\normalfont\Large\bfseries\color{HeaderColor}}
    {%
    \begingroup
    \setlength\fboxsep{3pt}%
    \setlength\fboxrule{0.9pt}%
    \fbox{\thesubsection}%
    \endgroup
    }
    {5pt}
    {}