\cs_new_protected:Npn \__keythms_thm_tcbcode:nn #1#2
  { % #1 = name, #2 = tcolorbox keys
    \tl_gput_right:cn { g__keythms_thm_preheadfromkeys_#1_tl }
      {
        \cs_set_eq:NN \deferred@thm@head \__keythms_thm_storedeferred@thm@head:n
        \cs_set_eq:NN \Hy@theorem@makelinktarget \use_none:n
        % % ^ don't like playing with hyperref internals... but don't see around
        % %   it because hyperref tries to add to para hook which doesn't work
        % %   when title set up the way we do it
      }
    \tl_gput_right:cn { g__keythms_thm_postheadfromkeys_#1_tl }
      {
        \cs_set_eq:NN \deferred@thm@head \__keythms_thm_origdeferred@thm@head:n
        \cs_set_eq:NN \Hy@theorem@makelinktarget \__keythms_thm_origHy@theorem@makelinktarget:n
      }
    \__keythms_thm_tcbshared:nn { #1 }
      {
        title={ \__keythms_thm_tcbtemphead: },
        #2
      }
    \bool_if:NT \l__keythms_thm_numbered_bool
      {
        \tl_gclear_new:c { g__keythms_thm_tcbpatch_#1_tl }
        \tl_gset:cn { g__keythms_thm_tcbpatch_#1_tl }
          {
            \IfPackageLoadedF { cleveref }
              { % hyperref doesn't patch \@thm if cleveref loaded
                \tcbset
                  {
                    keythms_tcb_#1/.append~style = % fix hyperlinking
                      { phantom={ \MakeLinkTarget*{\@currentHref} } }
                  }
              }
          }
      }
    \tl_gput_left:cn { g__keythms_thm_postheadfromkeys_#1_tl }
      { \begin{tcolorbox}[keythms_tcb_#1] }
    \tl_gput_right:cn { g__keythms_thm_prefootfromkeys_#1_tl }
      { \end{tcolorbox} }
  }