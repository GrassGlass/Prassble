%% The LaTeX project Prassble
%% NewListing.tex: code for custom tcolorbox minted boxes
%%
%% -------------------------------------------------------------------------------------------
%% Copyright (c) 2025 by Grass (GrassGlass) <shaohong00002 at gmail dot com>
%% -------------------------------------------------------------------------------------------
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `author-maintained'.
%%
%% This work consists of all files listed in README
%%
\makeatletter
\ExplSyntaxOn
  \NewDocumentCommand{\NewPCBListing}{ O{} m m m }{
    \NewTCBListing{ #2 }{ #3 }{ #4 }
    \BeforeBeginEnvironment{#2}{
      % Before the listing
        % The value of \linewidth where the corresponding listing environment is located
          % The name is \linewidth*outside* precisely because its the \linewidth (immediately) outside the listing environment
          \dim_set:Nn \g__Prassble_listings_autowidth@core_max_tcb_width_dim {\the\linewidth}%
        % The dimensions to 'grow to left/right' (<- tcbkey) by
          % These dimensions are set before the tcblisting starts, because we want the, e.g. \kvtcb@left@rule, of the previous/outer tcolorbox (that this tcblisting is to be nested in). 
          \dim_set:Nn \g__Prassble_listings_type_in_thmgroup_inner_left_growth_dim {\kvtcb@left@rule+\kvtcb@boxsep+\kvtcb@leftupper}
          \dim_set:Nn \g__Prassble_listings_type_in_thmgroup_inner_right_growth_dim {\kvtcb@right@rule+\kvtcb@boxsep+\kvtcb@rightupper}
    }
    \AfterEndEnvironment{#2}{
      % After the listing
        \__Prassble_listings_debug_autowidth:
        \stepcounter{code}%
    }
  }
\ExplSyntaxOff
\makeatother