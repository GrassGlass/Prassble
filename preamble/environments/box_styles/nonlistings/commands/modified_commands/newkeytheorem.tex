% 'type in thmgroup' tcbkeys that change which corners are rounded or sharp 
\tcbset{
    ,Prassble keytheorems/.style = {}
    ,type in thmgroup/.is choice
        ,type in thmgroup/first/.style = {
            ,sharp corners
            ,rounded corners = northeast
            ,after skip balanced = 0pt
        }
        ,type in thmgroup/middle/.style = {
            ,sharp corners
            ,beforeafter skip balanced = 0pt
        }
        ,type in thmgroup/last/.style = {
            ,sharp corners
            ,rounded corners = southeast
            ,before skip balanced = 0pt
        }
        ,type in thmgroup/standalone/.style = {
            ,sharp corners
            ,rounded corners = east
        }
}

\ExplSyntaxOn
\tl_new:N \g__Prassble_inner_style_tl
% The default inner style
    \tl_gset:Nn \g__Prassble_inner_style_tl { inner~1 }
% The inner type in thmgroup
    \tcbset{
        % The core code that stretches the box appropriately 
            ,type~in~thmgroup/inner~core/.style = {
                ,grow~to~left~by    = \g__Prassble_listings_type_in_thmgroup_inner_left_growth_dim
                ,grow~to~right~by   = \g__Prassble_listings_type_in_thmgroup_inner_right_growth_dim
            }
        % Predefined inner style 1
            ,type~in~thmgroup/inner~1/.style = {
                ,type~in~thmgroup   = middle
                ,opacityfill        = 0.0
                ,grow~to~left~by    = \g__Prassble_listings_type_in_thmgroup_inner_left_growth_dim
                ,grow~to~right~by   = \g__Prassble_listings_type_in_thmgroup_inner_right_growth_dim
                ,notitle
            }
        % Predefined inner style 2
            ,type~in~thmgroup/inner~2/.style = {
                ,type in thmgroup/middle/.style = {
                    ,beforeafter skip balanced = \baselineskip plus 4pt
                }
                % ,opacityfill        = 0.0
                ,grow~to~left~by    = \g__Prassble_listings_type_in_thmgroup_inner_left_growth_dim
                ,grow~to~right~by   = \g__Prassble_listings_type_in_thmgroup_inner_right_growth_dim
                ,notitle
            }
        % Key that allows users to easily choose the inner style they want
            ,inner~style/.code = {
                \tl_set:Nn \g__Prassble_inner_style_tl
            }
        % The inner style
            ,type~in~thmgroup/inner/.style = {
                type~in~thmgroup = \g__Prassble_inner_style_tl
            }
    }
\ExplSyntaxOff

\ExplSyntaxOn
    \keys_define:nn { keytheorems/thmuse }
        {
            ,tcb-add    .code:n = {
                \tcbset{
                    Prassble~keytheorems/.append~style = {#1}
                }
            }
            ,tcb-append .meta:n = {
                tcb-add = {#1}
            }
        }
    % The command \modifiedXptheorem{\Xkeytheorem} that creates an \Xkeytheorem (e.g. \newkeytheorem) that optionally saves the name of the environemnt into \g__Prassble_environments_used_in_HWs_clist and 
        \NewDocumentCommand{\modifiedXptheorem}{ m s m D(){} +O{} }
        {
            \clist_map_inline:nn {#3} {
            % Save the environment name iff \newptheorem is unstarred
                \bool_if:nF {#2} {
                    \clist_gput_right:Nn \g__Prassble_environments_used_in_HWs_clist {##1}
                }
            % Create the newkeytheorem with name ##1
                #1{##1}[#5]
            % Copy the newkeytheorem ##1 under another name Prassble_nonlisting_##1@core 
                % This allows us to modify the arg-spec of ##1 whilst preserving the name of \thetheorem, \theHtheorem, etc (rather than having \thePrassble_nonlisting_##1@core, etc).
                \NewEnvironmentCopy{Prassble_nonlisting_##1@core}{##1}
            % Re-define ##1 with our custom arg-spec
            \RenewDocumentEnvironment{##1}{ D(){#4} +O{} }
                {\tl_if_empty:nF {####1} {
                    \tcbset{Prassble~keytheorems/.append~style = {type~in~thmgroup = ####1}}
                }%
                \begin{Prassble_nonlisting_##1@core}[####2]}
                {\end{Prassble_nonlisting_##1@core}}
            }

        } 
        % Xkeytheorem = \newkeytheorem
        \NewDocumentCommand{\newptheorem}{ }{\modifiedXptheorem{\newkeytheorem}}
        % Xkeytheorem = \renewkeytheorem
        \NewDocumentCommand{\renewptheorem}{ }{\modifiedXptheorem{\renewkeytheorem}}
        % Xkeytheorem = \providekeytheorem
        \NewDocumentCommand{\provideptheorem}{ }{\modifiedXptheorem{\providekeytheorem}}
        % Xkeytheorem = \declarekeytheorem
        \NewDocumentCommand{\declareptheorem}{ }{\modifiedXptheorem{\declarekeytheorem}}
    % The command \StyleDependentValue[ <key> ]{ <name> }{ <clist of BoxStyles> }{ <clist of corresponding values for a key=value <key>> }{ <style macro> } that defines a macro \<name><key>, such that '<key> = \<name><key>' automatically adapts to the value of the <style macro>.
        % Declaring variables
        \int_new:N \l__Prassble_StyleDependentValue_number_in_boxstyles_int
        \tl_new:N \l__Prassble_StyleDependentValue_stylemacro_tl
        \clist_new:N \l__Prassble_StyleDependentValue_all_boxstyles_clist
        \clist_new:N \l__Prassble_StyleDependentValue_value_for_key_clist
    \NewDocumentCommand{\StyleDependentValue}{ O{} m m m m }{
        % Initalising the macro that is the value for the keytheorems key 'Parent = '
        \tl_new:c {#2#1}
        % Defining #2 and #3 semantically as a clist
        \clist_set:Nn \l__Prassble_StyleDependentValue_all_boxstyles_clist {#3}
        \clist_set:Nn \l__Prassble_StyleDependentValue_value_for_key_clist {#4}
        % Defining #5 semantically as a token list
        \tl_set:Nn \l__Prassble_StyleDependentValue_stylemacro_tl {#5}
        % Setting the value in "parent = <value>" for the current Pagestyle
        \int_zero:N \l__Prassble_StyleDependentValue_number_in_boxstyles_int
        \clist_map_inline:nn {#3} 
        {
            \int_incr:N \l__Prassble_StyleDependentValue_number_in_boxstyles_int
            \tl_if_eq:enT {\l__Prassble_StyleDependentValue_stylemacro_tl} {##1} 
            {
                \tl_gset:ce {#2#1} 
                {
                    \clist_item:Nn \l__Prassble_StyleDependentValue_value_for_key_clist {\l__Prassble_StyleDependentValue_number_in_boxstyles_int}
                }
            }
        }
    }
\ExplSyntaxOff