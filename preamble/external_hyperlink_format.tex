%% The LaTeX project Prassble
%% external_hyperlink_format.tex: external link command \extref (a wrapper around \href)
%%
%% -------------------------------------------------------------------------------------------
%% Copyright (c) 2025 by Grass (GrassGlass) <shaohong00002 at gmail dot com>
%% -------------------------------------------------------------------------------------------
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `author-maintained'.
%%
%% This work consists of all files listed in README
%%
% External hyperlink special formatting
  % External link symbol
  % source: https://tex.stackexchange.com/a/294990/383565
  \newcommand{\ExternalLink}{%
      \tikz[x=1.2ex, y=1.2ex, baseline=-0.05ex]{% 
          \begin{scope}[x=1ex, y=1ex]
              \clip (-0.1,-0.1) 
                  --++ (-0, 1.2) 
                  --++ (0.6, 0) 
                  --++ (0, -0.6) 
                  --++ (0.6, 0) 
                  --++ (0, -1);
              \path[draw, 
                  line width = 0.5, 
                  rounded corners=0.5] 
                  (0,0) rectangle (1,1);
          \end{scope}
          \path[draw, line width = 0.5] (0.5, 0.5) 
              -- (1, 1);
          \path[draw, line width = 0.5] (0.6, 1) 
              -- (1, 1) -- (1, 0.6);
          }%
      }
  % href with underline and an external link symbol
    % % Implementation 1: using ltcmd's v-type verbatim arg-spec (NOT recommended as \macro{\extref{ <URL> }{ <link name> }} doesn't work)
    % \NewDocumentCommand{\extref}{ v m }{\href{#1}{\xunderline{#2}\:\ExternalLink}}
  % Implementation 2: https://tex.stackexchange.com/a/448977/383565
  % \NewDocumentCommand{\blink}{ O{} }{%
  %   %% We want the #-sign only to be a letter (catcode 11) temporarily, so begin the scope group
  %   \bgroup%
  %   % Below, # is made a letter until \egroup is called
  %   \catcode`\#=11\relax%
  %   % Trigger the URL-reader
  %   \makeblinkurl%
  % }
  % \NewDocumentCommand{\makeblinkurl}{ m m }{%
  %   % This will read the link and link description
  %   % after the # is made a letter by the \blink macro
  %   \href{#1}{\xunderline{#2}\:\ExternalLink}%
  %   % We want the #-sign only to be a letter up til here, so we group it.
  %   % the broup will start in the below \blink macro,
  %   % and we wnd it here:
  %   \egroup%
  % }
    % Implementation 3: modifying the source code of hyperref's \href
    \makeatletter
      \DeclareRobustCommand*{\extref}[1][]{%
        \begingroup
        \setkeys{extref}{#1}%
        \@ifnextchar\bgroup\Hy@extref{\hyper@normalise\extref@}%
      }
      %
      %
      \def\Hy@extref#{%
        \hyper@normalise\extref@
      }
      \begingroup
        \catcode`\$=6 %
        \catcode`\#=12 %
        \gdef\extref@$1{\expandafter\extref@split$1##\\}%
        \gdef\extref@split$1#$2#$3\\$4{%
          \hyper@@link{$1}{$2}{$4\:\ExternalLink}%
          \endgroup
        }%
      \endgroup
    \makeatother