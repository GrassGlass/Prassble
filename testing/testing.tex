\documentclass{book}
\usepackage{eqparbox}
\usepackage[skins, breakable, minted]{tcolorbox}
% Savebox
\newsavebox{\codewidth}

% Counters
  \newcounter{code}
  \setcounter{code}{1}

% Lengths
    \newlength{\BorderlineWestThickness}
    \newlength{\boxsep}
    \newlength{\boxrule}
    \newlength{\numbersep}
    \newlength{\linenumberpadding}
    \newlength{\titleleft}
    \newlength{\lefthspace}

    \setlength{\boxsep}{1pt}
    \setlength{\boxrule}{0pt}
    \setlength{\BorderlineWestThickness}{2pt}
    \setlength{\numbersep}{0.2474691189148802em}
    \setlength{\linenumberpadding}{0.2474691189148802em}
    \setlength{\lefthspace}{8.5pt}
    \setlength{\titleleft}{1.1pt}

% Colours
\def\ColorCodeBase{black}
\def\ColorCodeColback{\ColorCodeBase!5}
\def\ColorCodeColbacktitle{\ColorCodeBase!5}
\def\ColorCodeTitle{\ColorCodeBase!70!black}
\def\ColorCodeBorderline{\ColorCodeBase}
\def\ColorCodeLineNumber{\ColorCodeBase}
\def\ColorCodeLineNumberBackground{\ColorCodeBase!20}

\ExplSyntaxOn
\cs_new:Npn \__listings_codestylecore@borderlinewest: {
      \fill[\ColorCodeBorderline] (frame.south~west)
      rectangle ([xshift=\BorderlineWestThickness]frame.north~west);}
\tcbset{
  ,Title/.style = 
  {
    title   = 
    {
      \sffamily\bfseries\color{\ColorCodeTitle}
        {
          \hspace{-\eqboxwidth{code\arabic{code}}+\titleleft}
          #1
        }
      }
  }
  ,codestylebase/.style =
  {
    ,lefttitle                       = \eqboxwidth{code\arabic{code}}+\lefthspace+0.5\linenumberpadding
    ,leftupper                       = \eqboxwidth{code\arabic{code}}+\lefthspace+0.5\linenumberpadding
    ,listing~engine                  = minted
    ,minted~style                    = staroffice
    ,minted~options                  = 
      {
        ,breaklines
        ,autogobble
        ,linenos
        ,numbersep = \numbersep
      }
    ,listing~only
    ,breakable
    ,enhanced
    ,skin                            = enhanced~jigsaw
    ,boxsep                          = \boxsep
    ,boxrule                         = \boxrule
    ,colback                         = \ColorCodeColback 
    % ,Title                           = Name
    ,toptitle                        = 2mm
    ,bottomtitle                     = 2mm
    ,colbacktitle                    = \ColorCodeColbacktitle,
    ,borderline~west                 = {\BorderlineWestThickness}{0pt}{\ColorCodeBorderline}
    ,overlay~unbroken                = {
      % Background for the code line numbers
        % Case 1: The current (partial) box contains only an upper part.
        \int_compare:nNnT {\tcbsegmentstate}={0} {
          \filldraw[\ColorCodeLineNumberBackground] 
          (frame.south~west) --
          (interior.north~west) {[rounded~corners=4] --
          ++(\eqboxwidth{code\arabic{code}}+\linenumberpadding,0) --
          ([xshift=\eqboxwidth{code\arabic{code}}+\linenumberpadding]frame.south~west)} --
          (frame.south~west);
        }
        % Case 2: The current (partial) box contains an upper and a lower part. The segmentation node can be used for positioning.
        \int_compare:nNnT {\tcbsegmentstate}={1} {
          \filldraw[\ColorCodeLineNumberBackground] 
          (segmentation.west) --
          (interior.north~west) {[rounded~corners=4] --
          ++(\eqboxwidth{code\arabic{code}}+\linenumberpadding,0) --
          ([xshift=\eqboxwidth{code\arabic{code}}+\linenumberpadding]segmentation.west)} --
          (segmentation.west);
        }
      % Borderline west of \BorderlineWestThickness thickness
      \__listings_codestylecore@borderlinewest:
    }
    ,overlay~first                   = {
      % Background for the code line numbers
      \filldraw[\ColorCodeLineNumberBackground] 
      (frame.south~west) --
      (interior.north~west) {[rounded~corners=4] --
      ++(\eqboxwidth{code\arabic{code}}+\linenumberpadding,0)} --
      ([xshift=\eqboxwidth{code\arabic{code}}+\linenumberpadding]frame.south~west) --
      (frame.south~west);
      % Borderline west of \BorderlineWestThickness thickness
      \__listings_codestylecore@borderlinewest:
    }
    ,overlay~middle                  = {
      % Background for the code line numbers
      \fill[\ColorCodeLineNumberBackground] (frame.south~west)
      rectangle ([xshift=\eqboxwidth{code\arabic{code}}+\linenumberpadding]frame.north~west);
      % Borderline west of \BorderlineWestThickness thickness
      \__listings_codestylecore@borderlinewest:
    }
    ,overlay~last                    = {
      % Background for the code line numbers
        % Case 1: The current (partial) box contains only an upper part.
        \int_compare:nNnT {\tcbsegmentstate}={0} {
          \filldraw[\ColorCodeLineNumberBackground] 
          (frame.south~west) --
          (frame.north~west) --
          ++(\eqboxwidth{code\arabic{code}}+\linenumberpadding,0) {[rounded~corners=4] --
          ([xshift=\eqboxwidth{code\arabic{code}}+\linenumberpadding]frame.south~west)} --
          (frame.south~west);
        }
        % Case 2: The current (partial) box contains an upper and a lower part. The segmentation node can be used for positioning.
        \int_compare:nNnT {\tcbsegmentstate}={1} {
          \filldraw[\ColorCodeLineNumberBackground] 
          (segmentation.west) --
          (frame.north~west) --
          ++(\eqboxwidth{code\arabic{code}}+\linenumberpadding,0) {[rounded~corners=4] --
          ([xshift=\eqboxwidth{code\arabic{code}}+\linenumberpadding]segmentation.west)} --
          (segmentation.west);
        }
      % Borderline west of \BorderlineWestThickness thickness
      \__listings_codestylecore@borderlinewest:
    }
  }
}
\renewcommand{\theFancyVerbLine}{
                \eqmakebox[code\arabic{code}][c]{
                    \textcolor{\ColorCodeLineNumber}{\scriptsize\arabic{FancyVerbLine}}
                }
            }
\ExplSyntaxOff
\NewTCBListing{code}{ }{
    ,codestylebase
    ,minted language = text
}
\begin{document}
\begin{code}
    Test
\end{code}
\eqboxwidth{code\arabic{code}}

\eqframebox[code]{Hi}

\eqframebox[code]{Hello}
\end{document}