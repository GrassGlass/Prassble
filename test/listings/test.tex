%% The LaTeX project Prassble
%% test.tex: a document consisting of tests for our code environments and inputcode commands, to see whether our code works as intended (or if there are bugs to be fixed).  
%%
%% -------------------------------------------------------------------------------------------
%% Copyright (c) 2025 by Grass (GrassGlass) <shaohong00002 at gmail dot com>
%% -------------------------------------------------------------------------------------------
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `author-maintained'.
%%
%% This work consists of all files listed in README
%%
\ExplSyntaxOn
\AtEndDocument { \benchmark_toc: }
\benchmark_tic:
\ExplSyntaxOff
\documentclass[11pt, titlepage, a4paper, oneside]{book}
% \def\ColorTheme{BnW}
\input{../../preamble/preamble}
\usepackage{datetime2}

\renewcommand{\theFancyVerbLine}{%
                \eqframebox[code\arabic{code}][c]{%
                    \textcolor{\ColorCodeLineNumber}{\scriptsize\arabic{FancyVerbLine}}%
                }%
            }
\renewcommand{\FancyVerbFormatLine}[1]{\eqsavebox{\codewidth}[codeupperwidth\arabic{code}]{#1}\fbox{#1}}

\def\ColorCodeLineNumber{green!50!black}

\usepackage{showframe}

\newcounter{codeinput}
\newwrite\tmptextfile
\NewDocumentEnvironment{codeinput}{ O{} m c }{
    \stepcounter{codeinput}%
    \def\tmpfilename{\jobname\arabic{codeinput}.txt}%
    \immediate\openout\tmptextfile=\tmpfilename%
    \def\obeyedline{^^J}
    \immediate\write\tmptextfile{#3}%
    \immediate\closeout\tmptextfile%
    \inputcode*[#1]{\tmpfilename}
}{}

\begin{document}
\frontmatter
\chapter*{Last successful compile: \DTMnow}

This file is a compilation of various uses of the listing boxes generated with \codeinline{TeX}{\NewPCBListing} and \codeinline{TeX}{\NewPCBInputListing}. In this way, robustness checks are performed to ensure they function correctly---as bug-free as possible.
\begin{code}[debug=autowidth]{Text}
    Hello
\end{code}
%
\addtocontents{toc}{\protect\thispagestyle{empty}}
\tableofcontents
\thispagestyle{empty}
\newpage
\setcounter{page}{1}
%
\mainmatter
\chapter{Decorations}
\input{test_decorations.tex}

\chapter{Type in thmgroup: inner}
\section{NewPCBListing}
\begin{answer}(standalone)
    The first part of our answer.
    \begin{code}(inner 1){\TeX}
        The code for our answer.
    \end{code}
    \hspace{-\parindent-4mm} The second part of our answer lies here.
\end{answer}
\begin{answer}(standalone)
    The first part of our answer.
    \begin{code}(inner 2){\TeX}
        The code for our answer.
    \end{code}
    \hspace{-\parindent-4mm} The second part of our answer lies here.
\end{answer}
\begin{answer}(standalone)
    The first part of our answer.
    \begin{code}(inner){\TeX}
        The code for our answer.
    \end{code}
    \hspace{-\parindent-4mm} The second part of our answer lies here.
\end{answer}

\section{NewPCBInputListing}
\begin{answer}(standalone)
    The first part of our answer.
    \inputcode(inner 1){inner_lorem_ipsum.tex}
    \noindent The second part of our answer lies here.
\end{answer}
\begin{answer}(standalone)
    The first part of our answer.
    \inputcode(inner 2){inner_lorem_ipsum.tex}
    \noindent The second part of our answer lies here.
\end{answer}
\begin{answer}(standalone)
    The first part of our answer.
    \inputcode(inner){inner_lorem_ipsum.tex}
    \noindent The second part of our answer lies here.
\end{answer}

\chapter{Autowidth}
\section{NewPCBListing}
\input{test_NewPCBListing.tex}
\begin{code}[autowidth = upper, debug = autowidth]{Text}
    test
\end{code}

\section{NewPCBInputListing}
\RemoveFromHook{env/code/before}
\RemoveFromHook{env/code/after}
\RenewDocumentEnvironment{code}{ D(){standalone} ={OTitle} O{} m c}{
    \stepcounter{codeinput}%
    \def\tmpfilename{\jobname\arabic{codeinput}.txt}%
    \immediate\openout\tmptextfile=\tmpfilename%
    \def\obeyedline{^^J}
    \immediate\write\tmptextfile{#4}%
    \immediate\closeout\tmptextfile%
    \inputcode(#1)[#2]{\tmpfilename}
}{}
\input{test_NewPCBListing.tex}

\subsection{\texttt{\textbackslash Inputify}}
\InputCode{test/listings/sample_code.tex}
\InputCode[=,pwd]{\jobname\arabic{codeinput}.txt}
\InputCode[=,key=Ch]{ch1/sec1.tex}
\end{document}