%% The LaTeX project Prassble
%% test.tex: a document consisting of tests for our code environments and inputcode commands, to see whether our code works as intended (or if there are bugs to be fixed).  
%%
%% -------------------------------------------------------------------------------------------
%% Copyright (c) 2025 by Grass (GrassGlass) <shaohong00002 at gmail dot com>
%% -------------------------------------------------------------------------------------------
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `author-maintained'.
%%
%% This work consists of all files listed in README
%%
\ExplSyntaxOn
\AtEndDocument { \benchmark_toc: }
\benchmark_tic:
\ExplSyntaxOff
\documentclass[11pt, titlepage, a4paper, oneside]{book}
\input{../preamble/preamble}
\usepackage{datetime2}

\renewcommand{\FancyVerbFormatLine}[1]{\eqsavebox{\codewidth}[codeupperwidth\arabic{code}]{#1}\fbox{#1}}

\usepackage{showframe}

\newcounter{codeinput}
\newwrite\tmptextfile
\NewDocumentEnvironment{codeinput}{ O{} m c }{
    \stepcounter{codeinput}%
    \def\tmpfilename{\jobname\arabic{codeinput}.txt}%
    \immediate\openout\tmptextfile=\tmpfilename%
    \def\obeyedline{^^J}
    \immediate\write\tmptextfile{#3}%
    \immediate\closeout\tmptextfile%
    \inputcode*[#1]{\tmpfilename}
}{}

\begin{document}
\section*{Last successful compile: \DTMnow}

This file is a compilation of various uses of the listing boxes generated with \codeinline{TeX}{\ModifiedNewTCBListing} and \codeinline{TeX}{\ModifiedNewTCBInputListing}. In this way, robustness checks are performed to ensure they function correctly---as bug-free as possible.
\begin{code*}[debug=autowidth]{Text}
    Hello
\end{code*}
\chapter{ModifiedNewTCBListing}
\input{test_ModifiedNewTCBListing.tex}
\begin{code*}[autowidth = upper, debug = autowidth]{Text}
    test
\end{code*}

\chapter{ModifiedNewTCBInputListing}
\RenewDocumentEnvironment{code*}{ O{} m c }{
    \stepcounter{codeinput}%
    \def\tmpfilename{\jobname\arabic{codeinput}.txt}%
    \immediate\openout\tmptextfile=\tmpfilename%
    \def\obeyedline{^^J}
    \immediate\write\tmptextfile{#3}%
    \immediate\closeout\tmptextfile%
    \inputcode*[#1]{\tmpfilename}
}{}
\input{test_ModifiedNewTCBListing.tex}



\end{document}